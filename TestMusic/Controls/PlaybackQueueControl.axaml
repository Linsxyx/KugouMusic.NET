<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:TestMusic.ViewModels"
             xmlns:suki="https://github.com/kikipoulet/SukiUI"
             x:Class="TestMusic.Controls.PlaybackQueueControl"
             x:DataType="vm:MainWindowViewModel">

    <suki:GlassCard CornerRadius="15" Margin="5">
        <Grid RowDefinitions="Auto, *">
            <!-- 头部：标题与清空 -->
            <Grid Grid.Row="0" ColumnDefinitions="*, Auto" Margin="15,10">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="播放队列" FontWeight="Bold" FontSize="16" VerticalAlignment="Center" />
                    <TextBlock Text="{Binding PlaybackQueue.Count, StringFormat='({0})'}"
                               FontSize="12" Foreground="Gray" VerticalAlignment="Center" />
                </StackPanel>
                <Button Grid.Column="1" Classes="Basic" Content="清空"
                        Command="{Binding ClearQueueCommand}"
                        FontSize="12" Foreground="{DynamicResource SukiPrimaryColor}" />
            </Grid>

            <!-- 列表部分 -->
            <ListBox Grid.Row="1"
                     ItemsSource="{Binding PlaybackQueue}"
                     Background="#FFFFFFFF"
                     BorderThickness="0"
                     SelectedItem="{Binding CurrentPlayingSong}">
                <ListBox.Styles>
                    <Style Selector="ListBoxItem">
                        <Setter Property="Padding" Value="10,8" />
                        <Setter Property="CornerRadius" Value="8" />
                        <Setter Property="Margin" Value="5,2" />
                    </Style>
                </ListBox.Styles>
                <ListBox.ItemTemplate>
                    <DataTemplate DataType="vm:SongItem">
                        <Grid ColumnDefinitions="*, Auto">
                            <StackPanel Spacing="2">
                                <TextBlock Text="{Binding Name}"
                                           FontWeight="{Binding IsPlaying}"
                                           Foreground="{Binding IsPlaying}" />
                                <TextBlock Text="{Binding Singer}" FontSize="11" />
                            </StackPanel>

                            <!-- 操作按钮：播放此项 & 移除 -->
                            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button Classes="Basic"
                                        Command="{Binding $parent[suki:SukiWindow].((vm:MainWindowViewModel)DataContext).PlaySongCommand}"
                                        CommandParameter="{Binding .}">
                                    <TextBlock Text="▶" FontSize="10" />
                                </Button>
                                <Button Classes="Basic"
                                        Command="{Binding $parent[suki:SukiWindow].((vm:MainWindowViewModel)DataContext).RemoveFromQueueCommand}"
                                        CommandParameter="{Binding .}">
                                    <TextBlock Text="✕" FontSize="10" />
                                </Button>
                            </StackPanel>
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>
    </suki:GlassCard>
</UserControl>